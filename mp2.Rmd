---
title: "Mini-Project 2"
author: "Sylvie, Julia and Emily"
date: "March 7, 2018"
output: 
  html_document:
    code_folding: show
---
```{r setup, include=FALSE, message=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggplot2)
library(ggthemes)
library(RColorBrewer)
library(extrafont)
#install.packages("ggmap")
library(ggmap)
library(maps)
library(mapdata)
library(mosaic)
library(dplyr)
```

## Loading the data

```{r, include=FALSE}
load("house_elections.rda")
load("candidates.rda")
load("committees.rda")
load("contributions.rda")
```
 


```{r}
candidates_test <- candidates %>%
  select(c(cand_id, cand_office, cand_party_affiliation))

link_test <- candidates_test %>%
  left_join(contributions, by = "cand_id")

Republicans <- link_test %>%
  filter(cand_party_affiliation == "REP")
```

```{r}
total_contribution <- function(name_arg) {
  Republicans%>%
    filter(cand_id== name_arg)%>%
    group_by(year)%>%
    summarise(numb_contributions= n(),
              total_contribution = sum(transaction_amt))}
```

```{r}
Democrats <- link_test %>%
  filter(cand_party_affiliation == "DEM")

```


```{r}
H_candidates_2012<- candidates %>%
  filter(cand_office == "H",cand_election_yr==2012) %>%
  rename("candidate_name" = "cand_name") %>%
  rename("fec_id" = "cand_id") 
 votes_2012<- house_elections%>%
    group_by(fec_id)%>%
   summarize(Total_primary = sum(primary_votes), Total_general = sum(general_votes))
```

```{r}
H_candidates_2012 %>%
 full_join(votes_2012, by = "fec_id")%>% 
  rename("state" = "cand_state")
```


```{r}
elections <- house_elections%>%
  group_by(state) %>%
  summarise(gen_total=sum(general_votes),runoff_total=sum(runoff_votes), primary_total = sum(primary_votes))



committees_contrabutions <- committees%>%
 full_join(contributions, by = "cmte_id")
contrabutions_by_state<-committees_contrabutions %>%
  group_by(state) %>%
  summarise(transaction=sum(transaction_amt))  

contrabutions_votes <- elections%>%
 full_join(contrabutions_by_state, by = "state")

 
 
```


```{r}
cost <-contrabutions_votes %>%
  group_by(state) %>%
  summarise(votes = (runoff_total + gen_total + primary_total),cost_vote = transaction/votes)

vote_cost<-contrabutions_votes %>%
 full_join(cost, by = "state")%>%
  group_by(cost_vote, state, transaction,votes)
```



```{r}
state_district<-house_elections %>%
  group_by(state,district)%>%
  summarise(gen_total=sum(general_votes),runoff_total=sum(runoff_votes), primary_total = sum(primary_votes))
head(state_district, n=10)

vote_percent<-house_elections %>%
 merge(state_district, by = c("state","district")) %>%
  group_by(fec_id)%>%
mutate(ratio=(general_votes/gen_total), percent = (general_votes/gen_total)*100) 
winners<-vote_percent %>% 
  filter(ge_winner=="W")
general_election <- vote_percent %>%
  filter(percent > 1.5)

parties <- house_elections %>%
  group_by(party) %>%
  summarise(total_votes=sum(general_votes))

parties
```


{This function helps you pick out certain rows, it tells you the election results based on district and state}
```{r}
winner_2012<-function(state_arg,district_arg){
general_election %>%
    filter(state == state_arg, district == district_arg)%>%
    group_by(fec_id, general_votes, state, district, candidate_name, gen_total, party,incumbent)%>%
    summarise(percent = (general_votes/gen_total)*100)}

  bar_chart<-function(data_arg){print(ggplot(data_arg)+
 geom_bar(aes(x=candidate_name,y=general_votes, fill=party), stat="identity")+ 
  scale_fill_manual(values = c("D" = "darkblue", "R" = "red")))}

#example:
bar_chart(winner_2012("CA","18")) 


```



```{r}
ggplot(data=vote_cost,aes(x=votes, y = transaction)) +
  geom_point(aes(color=cost_vote))


```






